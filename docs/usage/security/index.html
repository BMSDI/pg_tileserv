<!DOCTYPE html>
<html>
  <head>
    
    <title>pg_tileserv</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.64.1" />
<title>Security :: pg_tileserv</title>
<link rel="shortcut icon" href="../../favicon.png" type="image/x-icon" />
<link href="../../css/nucleus.css" rel="stylesheet">
<link href="../../theme-flex/style.css" rel="stylesheet">

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
<link href="../../css/Fort-Fonts.css" rel="stylesheet">
<link href="../../css/custom.css" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
<script src="../../js/jquery-2.x.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.bundle.min.js" integrity="sha384-zDnhMsjVZfS3hiP7oCBRmfjkQC4fzxVxFhBx8Hkz2aZX8gEvA/jsP3eXRCvzTofP" crossorigin="anonymous"></script>
<script src="../../js/main.js"></script>
<script src="../../js/toc.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/pramsey.github.io\/pg_tileserv";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/usage/security/">
    
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
  
<a class="navbar-brand" href="https://www.crunchydata.com/"><img alt="Crunchy Data" src="../../images/logo.svg"></a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <ul class="navbar-nav mr-auto"></ul>
  <span class="navbar-text">
  </span>
</nav>

<article>
  <aside>

    <ul class="menu">
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="">
        </div>
        <script type="text/javascript" src="../../js/lunr.min.js"></script>
        <script type="text/javascript" src="../../js/auto-complete.js"></script>
        <link href="../../css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/pramsey.github.io\/pg_tileserv";
          
        </script>
        <script type="text/javascript" src="../../js/search.js"></script>
      </div>

      <hr>
      <a class="baselink" href="../../">pg_tileserv</a>
      <hr>

      <b>Navigation</b>
          <li data-nav-id="/" class="dd-item">
          <a href="../../">
            Home
          </a>
          </li>
    <li data-nav-id="https://pramsey.github.io/pg_tileserv/introduction/" class="dd-item
        ">
      <div>
      <a href="../../introduction/">About pg_tileserv</a>

      </div>
    </li>
    <li data-nav-id="https://pramsey.github.io/pg_tileserv/installation/" class="dd-item
        ">
      <div>
      <a href="../../installation/">Installation</a>

      </div>
    </li>
    <li data-nav-id="https://pramsey.github.io/pg_tileserv/usage/" class="dd-item parent haschildren
        ">
      <div>
      <a href="../../usage/">Usage</a>
            <i class="fas fa-angle-down fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/usage/metadata/" class="dd-item">
        <div>
          <a href="../../usage/metadata/">
            Service Metadata
          </a>
        </div>
    </li>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/usage/table-layers/" class="dd-item">
        <div>
          <a href="../../usage/table-layers/">
            Table Layers
          </a>
        </div>
    </li>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/usage/function-layers/" class="dd-item">
        <div>
          <a href="../../usage/function-layers/">
            Function Layers
          </a>
        </div>
    </li>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/usage/function-layers-advanced/" class="dd-item">
        <div>
          <a href="../../usage/function-layers-advanced/">
            Advanced Function Layers
          </a>
        </div>
    </li>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/usage/security/" class="dd-item active">
        <div>
          <a href="../../usage/security/">
            Security
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://pramsey.github.io/pg_tileserv/examples/" class="dd-item haschildren
        ">
      <div>
      <a href="../../examples/">Examples</a><i class="fas fa-angle-right fa-lg category-icon"></i>

      </div>
        <ul>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/examples/example-openlayers/" class="dd-item">
        <div>
          <a href="../../examples/example-openlayers/">
            OpenLayers Example
          </a>
        </div>
    </li>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/examples/example-mapbox-gl-js/" class="dd-item">
        <div>
          <a href="../../examples/example-mapbox-gl-js/">
            Mapbox GL JS Example
          </a>
        </div>
    </li>
      <li data-nav-id="https://pramsey.github.io/pg_tileserv/examples/example-leaflet/" class="dd-item">
        <div>
          <a href="../../examples/example-leaflet/">
            Leaflet Example
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="https://pramsey.github.io/pg_tileserv/learn-more/" class="dd-item
        ">
      <div>
      <a href="../../learn-more/">Learn More</a>

      </div>
    </li>
    <li data-nav-id="https://pramsey.github.io/pg_tileserv/troubleshooting/" class="dd-item
        ">
      <div>
      <a href="../../troubleshooting/">Troubleshooting</a>

      </div>
    </li>




      <hr><nav id="TableOfContents"></nav>



      <section>
      </section>
    </ul>
  </aside>
  <section class="page">

    <div class="nav-select">
      <center>Navigation :
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/introduction/" >
   About pg_tileserv</option>
    <option value="/installation/" >
   Installation</option>
    <option value="/usage/" >
   Usage</option> 
      <option value="/usage/metadata/" >- Service Metadata</option>
      <option value="/usage/table-layers/" >- Table Layers</option>
      <option value="/usage/function-layers/" >- Function Layers</option>
      <option value="/usage/function-layers-advanced/" >- Advanced Function Layers</option>
      <option value="/usage/security/"  selected>- Security</option>
  
    <option value="/examples/" >
   Examples</option>
    <option value="/learn-more/" >
   Learn More</option>
    <option value="/troubleshooting/" >
   Troubleshooting</option>



        </select>
      </center>
    </div>

    
      <div id="top-bar">
        
          
          
          
        <div id="top-github-link">
          <a class="github-link" href="../../contributing/" target="blank">
            <i class="fa fa-info-circle"></i>
            
          </a>
          <a class="github-link" href="https://github.com/CrunchyData/pg_tileservusage/security.md" target="blank">
            <i class="fa fa-code-fork"></i>
            
          </a>
        </div><div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                <i class="fa fa-bars"></i>
              </a>
            </span>
            <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
            <span class="links">
            







 <a href='https://pramsey.github.io/pg_tileserv/'>pg_tileserv</a> > <a href='https://pramsey.github.io/pg_tileserv/usage/'>Usage</a> > Security

 

 


            </span>
        </div>

      </div>
    

    
    <div id="body-inner">

    <h1>Security</h1>

    

    
    <p>The basic principle of security is to connect your tile server to the database with a user that has just the access you want it to have, and no more. To support different access patterns, create different users with access to different tables/functions, and run multiple services, connecting with those different users.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">USER</span> <span style="color:#111">tileserver</span><span style="color:#111">;</span>
</code></pre></div><p>Start with a blank user. A blank user will have no select privileges on tables it does not own. It will have execute privileges on functions. However, the user will have no select privileges on tables accessed by functions, so effectively the user will still have no access to data.</p>
<h2 id="tables">Tables</h2>
<p>If your tables are in a schema other than public, you will have to also grant &ldquo;usage&rdquo; on that schema to your user.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a8c8">GRANT</span> <span style="color:#00a8c8">USAGE</span> <span style="color:#00a8c8">ON</span> <span style="color:#00a8c8">SCHEMA</span> <span style="color:#111">myschema</span> <span style="color:#00a8c8">TO</span> <span style="color:#111">tileserver</span><span style="color:#111">;</span>
</code></pre></div><p>You can then grant access to the user one table at a time.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a8c8">GRANT</span> <span style="color:#00a8c8">SELECT</span> <span style="color:#00a8c8">ON</span> <span style="color:#00a8c8">TABLE</span> <span style="color:#111">myschema</span><span style="color:#111">.</span><span style="color:#111">mytable</span> <span style="color:#00a8c8">TO</span> <span style="color:#111">tileserver</span><span style="color:#111">;</span>
</code></pre></div><p>Alternatively, you can grant access to all the tables at once.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#00a8c8">GRANT</span> <span style="color:#00a8c8">SELECT</span> <span style="color:#00a8c8">ON</span> <span style="color:#00a8c8">ALL</span> <span style="color:#111">TABLES</span> <span style="color:#00a8c8">IN</span> <span style="color:#00a8c8">SCHEMA</span> <span style="color:#111">myschema</span> <span style="color:#00a8c8">TO</span> <span style="color:#111">tileserver</span><span style="color:#111">;</span>
</code></pre></div><h2 id="functions">Functions</h2>
<p>As noted above, functions that access table data effectively are restricted by the access levels the user has to the tables the function reads. If you want to completely restrict access to the function, including visibility in the user interface, you can strip execution privileges from the function.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- All functions grant execute to &#39;public&#39; and all roles are
</span><span style="color:#75715e"></span><span style="color:#75715e">-- part of the &#39;public&#39; group, so public has to be removed
</span><span style="color:#75715e"></span><span style="color:#75715e">-- from the executors of the function
</span><span style="color:#75715e"></span><span style="color:#00a8c8">REVOKE</span> <span style="color:#00a8c8">EXECUTE</span> <span style="color:#00a8c8">ON</span> <span style="color:#00a8c8">FUNCTION</span> <span style="color:#111">myschema</span><span style="color:#111">.</span><span style="color:#111">myfunction</span> <span style="color:#00a8c8">FROM</span> <span style="color:#00a8c8">public</span><span style="color:#111">;</span>
<span style="color:#75715e">-- Just to be sure, also revoke execute from the user
</span><span style="color:#75715e"></span><span style="color:#00a8c8">REVOKE</span> <span style="color:#00a8c8">EXECUTE</span> <span style="color:#00a8c8">ON</span> <span style="color:#00a8c8">FUNCTION</span> <span style="color:#111">myschema</span><span style="color:#111">.</span><span style="color:#111">myfunction</span> <span style="color:#00a8c8">FROM</span> <span style="color:#111">tileserver</span><span style="color:#111">;</span>
</code></pre></div>


    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="https://pramsey.github.io/pg_tileserv/usage/function-layers-advanced/" title="Advanced Function Layers"> <i class="fa fa-chevron-left"></i><label>Advanced Function Layers</label></a>
    <a class="nav nav-next" href="https://pramsey.github.io/pg_tileserv/examples/" title="Examples" style="margin-right: 0px;"><label>Examples</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  

  </div>


	<div>
	</div>
</footer>

<link href="../../css/featherlight.min.css" rel="stylesheet">
<script src="../../js/featherlight.min.js"></script>

<script src="../../theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>
