language: go
sudo: false
matrix:
  include:
  - go: tip
    os: linux
    env: CROSS_COMPILE=true
before_install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt update; fi
install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt install gcc-mingw-w64 libc6-dev-i386;
  fi
script:
- go build; mkdir upload; zip upload/pg_tileserv_snapshot_linux.zip pg_tileserv README.md
- if [ "$TRAVIS_OS_NAME" = "linux" -a "$CROSS_COMPILE" = "true" ]; then env CGO_ENABLED=1 GOOS=windows GOARCH=amd64 CC=x86_64-w64-mingw32-gcc go build -v; zip upload/pg_tileserv_snapshot_windows.zip pg_tileserv.exe README.md; fi
deploy:
  on:
    repo: CrunchyData/pg_tileserv
    branch: master
  provider: s3
  region: us-east-1
  bucket: postgisftw
  local_dir: "./upload"
  overwrite: true
  verbose: true
  edge: true
  access_key_id:
    secure: "R7uQBxt9E7JgdYhTdzitqz9kyN+Qw3Wc4rPyA+ZAkND0b402tumuMnpwftI4zuBrAYM6zPNZdvtoUm9zZPsYsfMCnrBtBZ04ajYxCRHrwUqAeKv8JlpYsw6Q0WZq3Hvxuja8b92QDwK+lmzJmc0kBFUEBQ04yY4D6OrdOHk7XYknfdoCcZkDvW4db+rXFDRgVNLF41XussFFEM6ipueH/c37GzL4v9USTeDfcw/S7wJQcYWeDPVVubwh571bSKwjdoVcNjjv30aLKiykNUtmdcHjbcn+BGJCXjxGDSftbvw9K42FfB5fjbCbZ0HIiBgaES2J4DRWfemCi/gSK5rlUan4p3IXx+3pU7PiJWZMO4eRN+nOScolGtRnBR5PrwYhJ3L+o6WwskLAuIQZjc0POyJVgfm4zKsOmwiLEO8JmqkApEVRtOE+rNiyuYmYVvYmyMilgK8gFfD57+hODRnTPfNMeWZlb4W48ctTkldqF4shP2y4S8FR30uTJJ4ttbGCzsHPT2IG84BRiW5jHh/2dMHba75KPJl59AbIMmd69B8ghlBzSre40AtQ+gQtejJ42EuSJ2hj3xUAW0F8hJKMjk4Av3wC5zJKlM2X7IGIaojxk3Grweu65LcqdEk36ImW/ESfU1wu5k51Ctf7yVlVX1EKiMAEaLF04l0OdikO33w="
  secret_access_key:
    secure: "GoG3+zltAqd5TM5PYGJCeHJDdbGMIZZmJYSp6EdAzbVikNyjWTTfwzYJKXU7gLYStqBk9pGrvGY6PPu+jhlAmZiakEzgPaM/zJ15dHjKiJWppcCmtB8fOA4BD3xLIAKR1d4j3tUgIvVfaUheeFkIo4sd4FAyY9E2nl69mc52oqqXBUDa7IsWELXOuddz4d9P3eZSsjbYNWw6ZxlUYTC90RqRJmYoqU8eLycmHsVEeCDY3sqqqkvszh7uFWCJTU8G6Ahvfh1GTTRSu7pvm8pLqibwYQb6t+e2nMAyPF3fN6xfVSa19Tqe22n0FxVxXLWe7V41p19jC9OJ/uuXdrRX4gP4GQ31KRaOMYWnEdKXye/39XEYp1teyL7Fwir0v3QYNCThB7YVjjzS5LDvHZXYjg2rhB3Kk1UxLToYLcCdfmlK0CRSWdi8Ur0b1+pKqKhfaN5vwO/hOz5nLIeFCDVpVsUliI+wgqe7EFKfhpniqES4kzYWr9OTiKJtMn+Q0xo3qpkd6y5RnAXq8pYVfSFsMIqcTMQzYuH9/A3FyAkwBkz+mt82tdXFGml5EkaWluHoruVWxr8W2MsH9SQWoJU9oI3C95HJAwgX3NWMTeZucxu5MazF/OqBjVUBXcXs2ieuS+Xpv7zEqeBBm6h0ipcACDU37bGaoqNtCODFdJlfoT4="
  cleanup: false


