language: go
sudo: false
matrix:
  include:
  - go: tip
    os: linux
    env: CROSS_COMPILE=true
before_install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt update; fi
install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt install gcc-mingw-w64 libc6-dev-i386;
  fi
script:
- go build; mkdir upload; zip upload/pg_tileserv_snapshot_linux.zip pg_tileserv README.md
- if [ "$TRAVIS_OS_NAME" = "linux" -a "$CROSS_COMPILE" = "true" ]; then env CGO_ENABLED=1 GOOS=windows GOARCH=amd64 CC=x86_64-w64-mingw32-gcc go build -v; zip upload/pg_tileserv_snapshot_windows.zip pg_tileserv.exe README.md; fi
deploy:
  on:
    repo: CrunchyData/pg_tileserv
    branch: master
  provider: s3
  region: us-east-1
  bucket: postgisftw
  local_dir: "./upload"
  overwrite: true
  verbose: true
  edge: true
  cleanup: false
  access_key_id:
    secure: "QqKxXg1qLAewEANWlj54Ij4u3mJpCtNzRN/HtQv9Ze1TUirXFh5K8K1VZId0r3UoF/JcvOwlV7/CIS0yixD+S0OACOeCR4iLthQz60/+pdJhLZEFcfRLWslxufG0GU6+RyE4fIkNbadEh2f5PcV1P1fQtEQrLZ8hK5sKsGShKSV7hnBNomYI3iQKV5z6GhgYQZohsIF2v2xljUTfOCTV/QLZ+wG7P5j5Tf5gTQLOHLMxGB4pzRkJIc3wrJ+kLFjJpnfAFcFG3kpxPKqS5txVXuD4EUr/gLKRUfP/7jaHGLq/chiALgQDidiVDnKhScfN7BQMjG56UgppKFolrh7eE3r3EMEccRsKm2F71B3v/YQNIqj++v8xYSaeK0PZpzRRRuWQiBPkFi65NlNLJdU2BDQKKBGfmEcEjYrmLejVk/0TN1MbMucG3NUNx+sjEAEYKB3hDkgZf84c2CXegNkBvc1zJaAR1b76fS5IbmmmR/bKYEzDuZ34HXFalrNxSvzmGKhQHlCikmE6Mi/AwiWAusBPnECLBRPT19Lj0YC2RAwpr+b5GXPbkUlQlm+fnks6YweRpYRZBbl7mmAV4PUJGpfjYLBfLSn56EnlW1B/xjR+RV4jp/EXFih0NHEjE0BAxsVj2tIy1MHUB9vVPGNz5W6SQsLXz6Xjjm9NxoMmlfU="
  secret_access_key:
    secure: "Rqty64/KW8Y1cq9lE1GQiQUI6IFKxMY2tZ+FGPZ4taqX5RdYMxpRFhKS8ojG5b9xiogwMI7G3JZsDWOnJSU5yniRlkvZlx8T3OfcR9Jg6l4s1Mm3KXPLcQ8lYMX88fYsMp1nW0zMQK3nW7qcy72urY7J7+EBVSTH1rkiacwdjBuie+ZDWxR3PuuP26mZh7NKCwKsTPx3MLsBgkCdgDl/KY5glQxs1x0R6f0gnoc7kJOuBEEp0lZ1m2nQGfj5Ji4je15NEHk8gTYpN3AkAvATJ8CyFGyWT172pc1goqVgv1udJRpm803E5cPZsdEiQYwuI7HZQjvmQ9XPXCFWLdGav6yQ3A++rnKXnmTN0j0eUA8aVF93ZE0xp7hifhC16+dVyz5lPHWXNMszIaBntlcoEB527T/vWht8s21QMG5qsrbirOCJXP+T4oBK8refJbVFFhjKxMzBDQdO7Zuowd6bOshmnr8knZbNGilH//s2pF7+8mwFN+4vWK/YRDMqzLiP8xqKhC37oLyEPNhN1obEX4/PgJ0GOMd2SpM6SftjRelP4o9364uPUvtyDBB7VBDcFMJNFZZlfxOKSoq4lkB877KC4U68tKnjgknlz9rJXWJ2lVVBS03kPkHVIqxat/h1guYWq4vdLE4lhXTpHSkEHlOcQD+bKCtkJ/zDnk/aZqI="

