language: go
sudo: false
matrix:
  include:
  - go: tip
    os: linux
    env: CROSS_COMPILE=true
before_install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt update; fi
install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt install gcc-mingw-w64 libc6-dev-i386;
  fi
script:
- go build; mkdir upload; zip upload/pg_tileserv_snapshot_linux.zip pg_tileserv README.md
- if [ "$TRAVIS_OS_NAME" = "linux" -a "$CROSS_COMPILE" = "true" ]; then env CGO_ENABLED=1 GOOS=windows GOARCH=amd64 CC=x86_64-w64-mingw32-gcc go build -v; zip upload/pg_tileserv_snapshot_windows.zip pg_tileserv.exe README.md; fi
deploy:
  on:
    repo: CrunchyData/pg_tileserv
    branch: master
  provider: s3
  region: us-east-1
  bucket: postgisftw
  local_dir: "./upload"
  overwrite: true
  verbose: true
  edge: true
  access_key_id:
    secure: "VPJSYIVVyiViuUVCrs9J2D7oRAi0p1EXk8vJlitKC7279K5bAoe1iZ05ZXaVnRiEIiSnmd4pc/uhouE/+DQztOLZ48jwJ5NQLOgRRoHS7CoM1aoJVtLmRqo8r+x/jo65Fmh7dfaJGZZ7xyw4PPxZX47rsrlSsxBxoJu0tsOXJ+h2a4FBon5x3KT2fX82pDpkj6mV/Ksvl5yy888/hQHVXojmXNPj/wPmgmk2oq0ekXr/9uFnGBekk9fyfarHRs3o7+Umx7Rf/f7DzFyK42zhkzg335s/sJpA4HOJmWVksTBxnWZUKlsbpKif7dLCidjfzYk+whnDhs5ry0cjmRe7+7cC6GQPVUCXF1HiZNIJAfwmbeiK/H0myLQ3SVTmd89fF1T0NH9NEbxGcGXkdd77CEuu9jShD46spLUPbW9xUA0LEKEX65rhIbBHOH8djC9k2QruMqXF3EvGhyWjSwlnl9VitPyPEHs5Dbvijo24MAnBuetAtMYzEPBL5X+mEwVAJny/9qiewveLNWZVBAFfuCywfV820P9sU5oo6VcIfGLxf01OeuwgAHGxqut8O3Fu3lQ5h8LFlBZlG6Co8iiCGUIu8myN2zO5S1/F7BG0VJprUIvHVhIRd41R8kh+ojX/66bAIRiSIlfWZzVysKY62eiZOR1sXTHBp9MdykN9itk="
  secret_access_key:
    secure: "rrLQLiHisGdEnwB3tCgAojKxMOs0Dwq89+dy73cQrqdNC2MlgqDDqc2IgjPBBv6PPEnw+ISKwt5vijOkvVkJ56EAMd+PUuNdzWtoj6k2PfL6zZoMFUMQ6Hn7piqMkUu2UacZJl4y/pUfk+yZBw75FfQa0Smt1s0p3bM7JfyNhtxKmj9lo9reAf6RCciqAku8zb8hLjH2LdST/iIZqc0XucFUfhoQCkEA4KvmxLstcdhE1z1s0Sp31StAkFczgFHcRK++a8FhY6J0u+EW7+HsQRxbPzgJ5DyFkz0aYsWEuMQdDUEPBYbFOG2g49JBM0K1TJzZNJ1j8MfWasVAhno4N5nrG4RtpZE9Ya9xvDbHZtkxNUnA8zeC7m5CERkHlc8Wil6eO1fDhLaeEed8iY+ml1sZZ88z4LFJar5M5QmGtE+p+abwP8tGGq+BKi9dCRhdkAkkaoR2OC4/pNoquQ1Ty5BAr+0SsdYuCXAMWwNYkdUzlSII84eLhCXe5d7it0PqM0PVob6mCfbTaCO1k86OODAh7vUdG7mPPQ6WCoBRibDMNeVd6MJOSWA63Qy/GAN2lhEup+XAC74MCTJMPwSgAKx1jywidm5lRSEaZlG9wOSWWXcgSnkSWX4HZBLhbLY0IZZqLdN7b1mG1mpiPQvG8JgCjzJce0Tc3RYPOE4SBss="
  cleanup: false


