language: go
sudo: false
matrix:
  include:
  - go: tip
    os: linux
    env: CROSS_COMPILE=true
before_install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt update; fi
install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt install gcc-mingw-w64 libc6-dev-i386;
  fi
script:
- go build; mkdir upload; zip upload/pg_tileserv_snapshot_linux.zip pg_tileserv README.md
- if [ "$TRAVIS_OS_NAME" = "linux" -a "$CROSS_COMPILE" = "true" ]; then env CGO_ENABLED=1
  GOOS=windows GOARCH=amd64 CC=x86_64-w64-mingw32-gcc go build -v; zip upload/pg_tileserv_snapshot_windows.zip
  pg_tileserv.exe README.md; fi
deploy:
  on:
    repo: CrunchyData/pg_tileserv
    branch: master
  provider: s3
  region: us-east-1
  bucket: postgisftw
  local_dir: "./upload"
  overwrite: true
  verbose: true
  edge: true
  cleanup: false
  access_key_id:
    secure: oa1XX9LwYEXoWCpBOmHTsFGZQLcKsE+mCFvvOlLeNHjB5YGxTTktkWyoSFWywkCMDb6KOMmnn0QbHuL/OWi0qKCUMNTW7CeD62CjVHVrlq0NAMbsJP4mHeZFZcySRIvHJCpUH1Ejk2V7jSPcQJt8FB2F8pWytWy7qau0Yjo1suydkwD/ItdVHaOoAs8N5bqoghaFTEDp61PN5CKQvkleim8XYR8GKLmW66iou1ub7fBELy0VAp8h1vC+cEqwsYgi8sSRz9wODA8l6Utipns283TPoZawhwaEEjU6Ko/xJvcT/VSyr3XPukNxc2KtVn8GpwZIobse/G7Bpy7FUiF3SDJ6FS11nxDEG5lH8gSZnPQNzxicdrso71LnJX9SGJAThlb/RDu46ibLkLnpBXeaP/rlTA4wo5MBnXUkTK9jVceEH1rhQ9vrTXeR/JVUY7PjCIfzFyc//MviR/LMRlS9xa3MHOzemKpbdVyNKYWOSgIukaU21zJI2DnhiFjMu/DdUOQTsUX1ktiOLF0p7ROx3dxZ/TxJaxr67hJ0JB2EO+NePW90MgJ6MkFVgwZBSqiEro4fhrZklcdN2gKkMljA94h4sRwgOlRJv4szMaPr7D4NXgKajR55bkF+R3ZtfmyZ3yDie/y2IrTjvEROlJ57aWLpaUH3xiMIziLCIFP//zc=
  secret_access_key:
    secure: SyBN35h+a+RC5tkujT6yxVF0u0yjbUH7Q8I44c09VQYJ4A3gi6B4IETqo2Pe3xaDxrxjfDhGfQEJXvNjFN8dllLNwLhVHuL/e64FTd7rCva/cHPPckFFTp8oQUE+pRiSzIyWDvVV+6ZeibQOITbnwSsl3zJBw0ChHKi1jiwpyEfuGvha35CsBxhJlko2tCqpX/7O0cIWiCD399yiCABvvZNm7nE48W2jNGrsEWrgIx7LYkJHFMhrtTF5LDOH7imlcbT2sutjqdb27UQ8KA0FUV7eR9GnL1x27w6csnZJfKopJoMb0mJTKC01imdpzKJCZmscSxc9NLGUv0vbHO6ozmIWIfdhS8s3yH4LLn5DuhTIAC8F1i+7Y11figkhx7pl1G/oRja51tacDv6MfDvy1mH7Yk2swsAy68bWW5NASC3utXvfVZ3kAyzvgWLj8y9jwd1Uj64oJPurtlLIHt/my93iHsK7oZbH2mA1zLaz3o6GjtjJBuhHL/c64aN57bLTEs7zAIsJBCf4Y7x85hzMhuXMd5FZpNnzkdIUiz8Qb36gnmaBkABoa/DyWAIybI7aEwGyS6SsxZLyChQFKkG0uWWYjzCpzbQ2tGyjV8ebLsTabuNqnHWeTj1eAZ4wBfGWcVBscNgOoDt5Xwx+DE6j59l7lKbm7Xy275jQfCm+edk=
