language: go
sudo: false
matrix:
  include:
  - go: tip
    os: linux
    env: CROSS_COMPILE=true
before_install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt update; fi
install:
- if [ "$CROSS_COMPILE" = "true" ]; then sudo apt install gcc-mingw-w64 libc6-dev-i386;
  fi
script:
- go build; mkdir upload; zip upload/pg_tileserv_snapshot_linux.zip pg_tileserv README.md
- if [ "$TRAVIS_OS_NAME" = "linux" -a "$CROSS_COMPILE" = "true" ]; then env CGO_ENABLED=1 GOOS=windows GOARCH=amd64 CC=x86_64-w64-mingw32-gcc go build -v; zip upload/pg_tileserv_snapshot_windows.zip pg_tileserv.exe README.md; fi
deploy:
  on:
    repo: CrunchyData/pg_tileserv
    branch: master
  provider: s3
  region: us-east-1
  bucket: postgisftw
  local_dir: "./upload"
  overwrite: true
  verbose: true
  edge: true
  access_key_id:
    secure: "s9+qZqXvISVlWa6TkQW35oQqhCzKD/a+NvgbNe0tu6ybdQ1mXug+R25kZMbOSUe3zbjYWEMkQ5cloQ57aW11fNth2r/Dp/oQZ6HwCdGYluP6ogmJIggsS5SRCbQGNpSGm/013/AngI0wREpHvqlMnL4XAVO4uHmvYa9RabcKHf/sV8n6yecsWiJ4nBTJi+5qnaur2NryhRkWnWnboRER0X65+NaBUPYQdBBatQ+I0nRDME/GUyuNqX64yifkAyn305kfbVms8/9wYJMttqwCVm/n1SEMk4xKONp3EB2IqWNDqMjUVgRgZK7lSE4NN58aYiS4UaFF/3SIhIyBlxkxLcpTnRQJQWdP+qDkqd7OkQmq7OM6rCucVSD/9+Oae6vwjdB4jusK7myDcCYKjdmpy9ZCJ+EhUotx+bwIqFbUW5C8OGLiVQIbJ0zG+hsssHQmLzE1sYiy7Li90ixd1QCwRPe1dWroUo3lis//fKpYwqg97aQQvxxpZC/UoA4mGoqfq4DALuRYQRz88mYYrVLJlNndroqnVNVZE8WJSQFlRdpK++bejVRTECHyobUCAgArH7AolC4OCvKHzKE9Wd9PvvWDmj0S5gV/3RUaYEHowmDBzoNkXH8/gzzyrCzRzJiAhKu3sASm/X6fU5fbWzrRK0B34xs1K6ctXpnktHFAJz4="
  secret_access_key:
    secure: "Uhd/VkBpMGFOVb5Q/TqBwh6ZkK4ar23aHXGRv5Zbtvjdqx7issaUmYj6zGlnQratokl5yZioyyarWvHjVznRftdtI1omudIYQqI3SEJqL0vhhAa4Klmy4Qj2DCQNhy8JxOjujaXYPiLCKYMcQ2uBeLOyDEv5szydvWKvc5kqRs5XgncZLEuwl33KlKVWo2FMXNycxa1Gq2piK9tAWKy8jT3ndpTC0r1bopJsgXZcgUaRsxUkJeO3kH6KrVQZWFA5bOzDckwyfQLH1JuELhAMdRhYOf+K30aTWy8fvQ+AKnsVsRyQ24KfYoeFI0eRLsvtceNPPqX+jrPMTQoijS6i6F61O6CbzzFXrIcDsxgBO3lVtuEA/vfoqwdaYQkrG5SeWHusWLLjbu+CE753Q5UGUTJFokffdWbJJ1iYrovTKTv3Q7NEdAKLysR3OPDLNAR9X2cJWz+W4wTNoC/USKvScibQYaDAwGaBKodO2PdaIbWZeAH/ihL9lTTFrdO+HNDE/7LS2Is0/RXx/6EhOMABynrqnr0tc22rwXFSD4cqn1+NRcTiZoYag4cTwzEC1/hHHClBaOi20qIcu/D4UvZj84yEVGj2RNqoREqNsrQLyQQW8+RuruJLT0Q0qPoQkYj0FX3RqITeRTDnfLsrmBQUA30T717LdxFRLkG+GmlO1HY="
  cleanup: false


